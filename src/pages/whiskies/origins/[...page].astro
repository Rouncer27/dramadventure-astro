---
import { Image } from "astro:assets";
import Layout from "../../../layouts/Layout.astro";

export async function getStaticPaths({ paginate }) {
  const response = await fetch(`${import.meta.env.WPGRAPHQL_URL}`, {
    method: "POST",
    headers: {
      "content-type": "application/json",
    },
    body: JSON.stringify({
      query: `
        query whiskeyOriginsQuery {
            whiskeyOrigins(first: 999999) {
                nodes {
                    name
                    slug
                    uri
                    whiskyOriginContent {
                    originFlag {
                      sourceUrl
                    }
                  }
                }
            }
        }
      `,
    }),
  });

  const { data } = await response.json();
  const allOrigins = data.whiskeyOrigins.nodes;
  return paginate(allOrigins, { pageSize: 20 });
}

const { page } = Astro.props;
---

<Layout>
  <div>
    <div>
      <h1>All Whisky Origins</h1>
      <div class="wrap-med">
        {
          page.data.map((origin) => {
            console.log("origin", origin);
            return (
              <p class="origin-link">
                <a href={`/whiskies/origins/${origin.slug}`}>
                  <Image
                    src={origin.whiskyOriginContent.originFlag.sourceUrl}
                    width="150"
                    height="150"
                    alt={origin.name}
                  />
                </a>
              </p>
            );
          })
        }
      </div>
    </div>

    <nav aria-label="Origins">
      {page["url"]["prev"] && <a href={`${page["url"]["prev"]}`}>Prev</a>}
      {page["url"]["next"] && <a href={`${page["url"]["next"]}`}>Next</a>}
    </nav>
  </div>
</Layout>

<style>
  div {
    padding-top: 30rem;
  }

  .origin-link {
    width: calc((100% / 10) - 2rem);
    text-align: center;
    margin: 1rem;

    a {
      display: flex;
      align-items: center;
      position: relative;
      margin: auto;
      width: 7rem;
      height: 7rem;
      border-radius: 50%;
      box-shadow: 0.4rem 0.4rem 0.8rem 0rem #000;
      overflow: hidden;

      img {
        align-self: center;
        position: absolute;
        top: 0;
        left: 0;
        margin: auto;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }
  }
</style>
